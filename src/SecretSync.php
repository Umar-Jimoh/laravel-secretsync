<?php

namespace UmarJimoh\SecretSync;

use UmarJimoh\SecretSync\Helpers\SecretMapper;
use UmarJimoh\SecretSync\Interfaces\SecretProviderInterface;

/*
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
##################################################-.........-+#########+############################
##############################################-..................+####-.+###########################
##########################+---.......+#####+.......................-+-..-###########################
######################-.............#####+.......-###########+..........-###########################
###################+.......--+##########-.....-#################+........###########################
#################+.....-#######+++#####.....-#####+-.....-+######-.......+##########################
################....-####+.......+####-....-####+....++-...-####.........-##########################
###############....+##+.........-####+....-#####...#######..-####+-......-##########################
##############...-##-....-+##########-....#####+..+#######-..##########+++##########################
#############-..-##-...+####+-..#####....-#####+..+#######-..#######################################
#############-..##-..-###-......#####....-####+...............+#####################################
##############.-#+..-##-....--++#####....-####-...............-####.....############################
############+-###-.-##...-####################-.....-##+......-####.....############################
#############..-+#############################-......##+......+####....-############################
##############......---+++++####-.--++#########......##-......+###+....+############################
###############+............####+..........+###+.....--......+###+....-#############################
############+.+####++-------#####.........+######-.........-#####.....+####+++######################
#############-..-++##############-.......+#########++---+######-.....+####-.......-#################
##############-.............#####-........-##################+......##########+-.....###############
############++##+...........#####+...........-############+.......+###############+...+#############
############+..+##################..-##+...........---..........-######.........-###+..#############
#############+....######++########-#######+..................-#######+.............-##-+############
###############-+##+.........-################+-........-+######################+....+##############
##################.............+################################+-.........---+####+..-#############
#################.....-####-....#############################+....................+##-.+############
#################....-######...-################################################-...+#++############
#################.....+##########-....+#####+....-#-...+-......+#######-.......-+##-.-##############
#################+.......+#######+....-#####-....##-.............####-............##+.-#############
###################-........-#####+....+####....+##-....-###.....+##.....+####-....+#+.+############
#####################+-........+###.....###+...-###-...-#####....+#-....#######+++####-+############
#########################+-.....-###....+##....+###-...-#####....-#....-##############++############
############################-....+##+....#-...-####-...-#####....-#....-##############++############
################+-...#######+....+###-...-....#####-...-#####....+#-....########+#####+#############
################+.....-####+.....#####.......+#####-...-#####....+##.....#####+....+################
#################+..............######+.....-######-...-#####....-###.............+#################
###################+..........+########-....+######-...-#####....-####+.........-###################
#######################++++############....-##############################++++######################
######################################-...-#########################################################
##################################+......-##########################################################
##################################+.....+###########################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
####################################################################################################
*/

class SecretSync
{
    public function syncFromProvider(SecretProviderInterface $provider)
    {
        $secrets = $provider->getSecrets();

        if (isset($secrets['error'])) {
            return ['error' => $secrets['error']];
        }

        if (empty($secrets)) {
            return ['error' => "Failed to fetch secret from the provider: " . $provider->name()];
        }

        (new SecretMapper)->map($secrets);
    }
}
